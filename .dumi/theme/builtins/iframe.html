<!doctype html>
<html>

<head>
  <link rel="shortcut icon" href="https://gw.alipayobjects.com/zos/rmsportal/wNkELvnLHXPAlmqutRPI.png"
    type="image/x-icon">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
  <link rel="stylesheet" type="text/css"
    href="https://renderdev.alipay.com/p/yuyan_npm/@alipay_antd-mini-lyra/dev-s09001975971/web/lyra.css" />
  <link rel="preload" href="/preview.json" as="fetch" crossorigin>
  <link rel="preload" href="/preview-theme-dark.json" as="fetch" crossorigin>
</head>

<style>
  body {
    margin: 0;
  }
</style>

<body>
  <div id="root"></div>
  <script type="text/javascript"
    src="https://gw.alipayobjects.com/os/lib/react/18.0.0/umd/react.production.min.js"></script>
  <script type="text/javascript"
    src="https://gw.alipayobjects.com/os/lib/react-dom/18.0.0/umd/react-dom.production.min.js"></script>
  <script src="https://renderdev.alipay.com/p/yuyan_npm/@alipay_antd-mini-lyra/dev-s09001975971/web/lyra.js"></script>
  <script>
    const searchParams = new URL(location.href).searchParams;
    const theme = searchParams.get('less-theme');
    const page = searchParams.get('page');
    const platform = searchParams.get('platform');

    function getDist() {
      const server = searchParams.get('compilerServer');
      const list = ['appConfig.json', 'index.js', 'index.worker.js', 'index.html'];
      console.log(searchParams, server);
      return Promise.all(list.map(item => fetch(`${server}/${item}`).then(res => res.text()))).then(arr => {
        const dist = {};
        list.forEach((item, index) => {
          dist[item] = arr[index];
        });
        return dist;
      });
    }

    async function startWebOpenBoxLyraApp() {
      let dist;

      if (location.port) {
        dist = await getDist()
        console.log(dist);
      } else {
        const obj = await fetch(theme === 'dark' ? '/preview-theme-dark.json' : '/preview.json').then(res => res.json());
        dist = obj.dist;

      }

      window.OpenBoxLyra.StartWebOpenBoxLyraApp(
        {
          dist,
          enableAppxNg: true,
          maskThemeColor: '#f9fafb',
          lyraKey: '-441015578',
          simulatorStyle: {
            width: 360,
            height: 700,
          },
          lyraConfig: {
            zoom: 0.8,
            layoutHeight: 'match_parent',
            layoutWidth: 'match_parent',
            defaultDeviceName: 'iPhone 13',
            initWithAutoZoom: false,
            transparentBackground: true,
            hideTopBar: true,
            hideBottomBar: true,
            enableDeviceSkin: false,
            hideTitleBar: true,
            liteMode: false,
            launchParams: { page: decodeURIComponent(page) }
          }
        }
      )

    }
    startWebOpenBoxLyraApp();
  </script>
</body>

</html>
